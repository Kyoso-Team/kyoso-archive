<script lang="ts">
  import { sidebar } from '$stores';
  import { AppRail, AppRailTile } from '@skeletonlabs/skeleton';

  let selectedSection = sidebar.selectedSection;
</script>

{#if $sidebar}
  <div class="h-full grid grid-cols-[auto_auto] fill-white">
    <AppRail selected={sidebar.selectedSection} background="bg-surface-50-900-token">
      {#each Array.from($sidebar.sections.entries()) as [label, { icon }]}
        <AppRailTile value={label} {label}>
          {#if icon === 'settings'}
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24">
              <path d="m9.25 22l-.4-3.2q-.325-.125-.613-.3t-.562-.375L4.7 19.375l-2.75-4.75l2.575-1.95Q4.5 12.5 4.5 12.337v-.674q0-.163.025-.338L1.95 9.375l2.75-4.75l2.975 1.25q.275-.2.575-.375t.6-.3l.4-3.2h5.5l.4 3.2q.325.125.613.3t.562.375l2.975-1.25l2.75 4.75l-2.575 1.95q.025.175.025.338v.674q0 .163-.05.338l2.575 1.95l-2.75 4.75l-2.95-1.25q-.275.2-.575.375t-.6.3l-.4 3.2h-5.5Zm2.8-6.5q1.45 0 2.475-1.025T15.55 12q0-1.45-1.025-2.475T12.05 8.5q-1.475 0-2.488 1.025T8.55 12q0 1.45 1.012 2.475T12.05 15.5Z"/>
            </svg>
          {:else if icon === 'pickems'}
            <svg xmlns="http://www.w3.org/2000/svg" width="42" height="30" viewBox="0 0 400 314.2857142857143">
              <g>
                <path d="M0.816 29.388 L 0.816 58.776 92.245 58.776 L 183.673 58.776 183.673 45.714 L 183.673 32.653 189.796 32.653 L 195.918 32.653 195.918 92.653 L 195.918 152.653 189.388 152.653 L 182.857 152.653 182.857 140.000 L 182.857 127.347 91.429 127.347 L 0.000 127.347 0.000 156.735 L 0.000 186.122 91.429 186.122 L 182.857 186.122 182.857 173.469 L 182.857 160.816 193.469 160.816 L 204.082 160.816 204.082 129.388 L 204.082 97.959 210.612 97.959 L 217.143 97.959 217.143 110.612 L 217.143 123.265 308.571 123.265 L 400.000 123.265 400.000 93.878 L 400.000 64.490 308.571 64.490 L 217.143 64.490 217.143 77.143 L 217.143 89.796 210.612 89.796 L 204.082 89.796 204.082 57.143 L 204.082 24.490 193.878 24.490 L 183.673 24.490 183.673 12.245 L 183.673 0.000 92.245 0.000 L 0.816 0.000 0.816 29.388 M244.725 130.246 C 208.410 139.051,195.496 185.717,222.032 212.253 C 235.234 225.454,253.954 229.769,273.195 224.045 C 275.690 223.303,277.626 226.717,275.565 228.224 C 273.914 229.431,315.169 309.670,318.984 312.671 C 322.072 315.100,326.733 314.812,329.883 311.996 C 334.852 307.557,334.901 307.688,311.899 263.673 C 300.519 241.898,290.875 223.434,290.468 222.643 C 289.920 221.578,289.358 221.401,288.309 221.963 C 284.324 224.096,283.984 218.335,287.922 215.392 C 328.304 185.211,294.319 118.222,244.725 130.246 M271.271 148.006 C 300.377 162.391,293.924 204.783,261.724 210.716 C 240.503 214.626,219.819 194.215,223.548 173.045 C 227.584 150.136,250.865 137.921,271.271 148.006 " />
              </g>
            </svg>
          {:else if icon === 'pooling'}
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 400 329.69121140142516">
              <g>
                <path d="M30.404 122.423 L 30.404 245.131 32.761 245.131 C 42.965 245.131,90.091 252.961,112.600 258.397 C 162.446 270.434,188.573 285.644,193.445 305.463 C 194.388 309.299,194.624 286.235,194.673 185.748 C 194.740 46.584,195.302 58.203,188.098 49.997 C 170.830 30.330,89.951 3.070,40.618 0.291 L 30.404 -0.285 30.404 122.423 M352.494 0.644 C 327.783 4.656,318.692 6.419,303.974 10.055 C 260.421 20.815,224.201 36.416,212.369 49.512 C 204.628 58.080,205.262 45.842,205.309 185.748 C 205.346 295.331,205.513 309.611,206.707 305.176 C 214.066 277.833,266.734 257.049,355.582 246.427 L 369.596 244.752 369.596 122.376 L 369.596 0.000 362.233 0.129 C 358.183 0.201,353.800 0.432,352.494 0.644 M-0.000 148.122 L -0.000 268.691 6.888 269.325 C 109.788 278.801,168.691 298.234,177.048 325.466 C 178.464 330.083,178.491 329.868,178.556 313.380 L 178.622 296.594 172.781 292.693 C 148.530 276.499,96.815 262.852,32.779 255.749 L 17.577 254.062 17.336 140.808 L 17.094 27.553 8.547 27.553 L 0.000 27.553 -0.000 148.122 M382.664 140.808 L 382.423 254.062 367.221 255.749 C 303.342 262.835,251.414 276.537,227.229 292.687 L 221.378 296.594 221.444 313.380 C 221.509 329.868,221.536 330.083,222.952 325.466 C 231.298 298.269,290.336 278.791,393.112 269.325 L 400.000 268.691 400.000 148.122 L 400.000 27.553 391.453 27.553 L 382.906 27.553 382.664 140.808 " />
              </g>
            </svg>
          {:else if icon === 'referee'}
            <svg xmlns="http://www.w3.org/2000/svg" width="38" height="32" viewBox="0 0 400 292.0245398773006">
              <g>
                <path d="M146.958 0.926 C 142.277 3.647,142.739 12.139,147.697 14.503 C 151.840 16.479,153.230 15.879,115.133 28.543 C 68.800 43.944,70.051 43.173,81.800 49.080 C 91.006 53.708,90.695 53.929,71.335 56.495 C 51.097 59.178,10.813 65.947,3.134 67.954 L 0.134 68.739 1.795 74.656 C 4.538 84.421,35.163 185.129,35.489 185.455 C 35.940 185.906,116.212 171.056,118.728 170.057 C 125.342 167.431,126.012 163.230,120.617 158.206 C 116.130 154.028,116.436 153.758,126.207 153.278 C 149.195 152.147,186.318 150.511,188.997 150.511 L 192.098 150.511 194.541 158.357 L 196.984 166.202 178.179 227.177 C 167.837 260.713,159.207 288.589,159.002 289.123 C 158.668 289.992,164.311 292.404,165.019 291.695 C 165.171 291.543,173.069 266.156,182.571 235.280 C 192.072 204.404,200.084 179.141,200.375 179.141 C 200.665 179.141,208.696 204.407,218.220 235.287 C 238.007 299.444,235.341 292.311,239.042 291.005 L 241.950 289.980 222.897 228.074 L 203.844 166.169 206.282 158.340 L 208.720 150.511 211.821 150.511 C 214.500 150.511,251.623 152.147,274.611 153.278 C 284.382 153.758,284.688 154.028,280.201 158.206 C 274.806 163.230,275.476 167.431,282.090 170.057 C 284.473 171.003,364.866 185.918,365.291 185.493 C 365.580 185.204,381.768 132.205,393.039 94.649 C 401.167 67.568,401.084 68.676,395.084 67.330 C 386.935 65.502,347.516 58.977,331.993 56.887 C 309.912 53.914,309.680 53.775,319.018 49.080 C 330.767 43.173,332.018 43.944,285.685 28.543 C 250.605 16.882,248.753 16.145,251.970 15.124 C 260.137 12.532,257.931 -0.038,249.321 0.026 C 242.641 0.075,238.890 6.816,242.598 12.110 C 243.799 13.825,202.103 153.767,200.387 153.780 C 198.687 153.793,157.031 13.807,158.227 12.100 C 163.021 5.257,154.331 -3.359,146.958 0.926 " />
              </g>
            </svg>
          {:else if icon === 'regs'}
            <svg xmlns="http://www.w3.org/2000/svg" width="35" height="32" viewBox="0 0 400 394.475138121547">
              <g>
                <path d="M62.139 1.145 C 57.548 2.990,55.247 24.829,58.883 32.044 C 60.706 35.660,71.816 36.708,75.262 33.589 C 77.439 31.620,78.474 6.709,76.502 3.757 C 74.220 0.338,67.286 -0.923,62.139 1.145 M100.901 1.113 C 96.988 2.689,96.133 5.804,96.133 18.466 C 96.133 33.945,96.965 35.359,106.077 35.359 C 115.293 35.359,116.022 34.050,116.022 17.514 C 116.022 1.238,111.842 -3.296,100.901 1.113 M139.227 0.709 C 135.443 2.194,134.807 4.737,134.807 18.364 C 134.807 34.678,135.207 35.359,144.791 35.359 C 150.099 35.359,151.515 34.964,152.447 33.222 C 154.350 29.666,153.923 3.861,151.933 2.209 C 150.087 0.677,141.799 -0.302,139.227 0.709 M176.796 1.366 C 173.696 3.002,171.948 28.220,174.591 33.160 C 176.128 36.031,187.782 36.369,190.529 33.623 C 192.833 31.319,193.070 5.943,190.817 2.861 C 188.943 0.299,180.520 -0.599,176.796 1.366 M38.957 21.707 C 30.492 25.880,30.939 20.885,30.939 111.285 L 30.939 191.923 45.805 208.945 L 60.671 225.967 123.429 226.519 L 186.188 227.072 186.188 233.702 L 186.188 240.331 130.236 240.884 L 74.283 241.436 86.550 255.525 L 98.816 269.613 144.361 269.613 L 189.906 269.613 190.639 267.127 C 192.012 262.468,204.441 240.351,209.410 233.723 L 214.365 227.115 214.365 128.881 C 214.365 32.320,214.327 30.586,212.137 27.044 C 209.594 22.929,204.015 19.890,199.004 19.890 L 195.580 19.890 195.580 27.072 C 195.580 37.119,193.888 38.674,182.953 38.674 C 172.462 38.674,170.166 36.465,170.166 26.370 L 170.166 19.890 163.536 19.890 L 156.906 19.890 156.906 27.072 C 156.906 37.119,155.214 38.674,144.279 38.674 C 133.788 38.674,131.492 36.465,131.492 26.370 L 131.492 19.890 125.414 19.890 L 119.337 19.890 119.337 26.370 C 119.337 36.465,117.041 38.674,106.550 38.674 C 95.615 38.674,93.923 37.119,93.923 27.072 L 93.923 19.890 87.293 19.890 L 80.663 19.890 80.663 26.370 C 80.663 36.465,78.367 38.674,67.876 38.674 C 56.941 38.674,55.249 37.119,55.249 27.072 L 55.249 19.890 48.895 19.915 C 45.353 19.929,40.955 20.722,38.957 21.707 M269.750 61.412 C 229.651 72.197,209.941 118.727,229.578 156.252 C 253.184 201.362,321.401 201.362,345.008 156.252 C 371.782 105.087,325.274 46.478,269.750 61.412 M179.898 71.668 C 180.873 72.287,181.232 74.528,181.003 78.558 L 180.663 84.530 115.470 84.530 L 50.276 84.530 49.936 78.558 C 49.707 74.528,50.066 72.287,51.041 71.668 C 52.929 70.471,178.010 70.471,179.898 71.668 M188.257 110.810 C 189.752 111.903,190.117 113.485,189.849 117.716 L 189.503 123.204 119.890 123.204 L 50.276 123.204 49.936 117.232 C 49.707 113.202,50.066 110.961,51.041 110.342 C 53.607 108.715,186.009 109.167,188.257 110.810 M162.431 155.811 L 162.431 162.451 106.354 162.165 L 50.276 161.878 49.930 157.056 C 49.318 148.514,44.593 149.171,106.595 149.171 L 162.431 149.171 162.431 155.811 M4.561 176.713 C 1.904 179.047,-0.085 181.509,0.141 182.184 C 0.367 182.858,24.171 210.463,53.039 243.527 C 105.321 303.409,105.560 303.663,114.694 308.859 C 125.831 315.195,125.613 315.375,121.213 303.496 L 117.637 293.843 64.620 233.184 C 35.460 199.821,11.105 172.512,10.497 172.497 C 9.890 172.482,7.218 174.379,4.561 176.713 M172.810 189.593 C 173.848 192.298,173.604 197.706,172.337 200.073 C 171.193 202.210,56.835 203.597,51.472 201.539 C 49.680 200.852,48.848 190.194,50.460 188.582 C 52.263 186.779,172.110 187.770,172.810 189.593 M265.317 200.050 C 212.384 213.912,178.533 279.798,174.933 375.967 L 174.241 394.475 287.293 394.475 L 400.346 394.475 399.660 376.519 C 395.059 256.049,337.948 181.029,265.317 200.050 " />
              </g>
            </svg>
          {:else}
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 400 504">
              <g>
                <path d="M24.484 2.563 C 16.683 6.106,8.393 14.026,4.230 21.915 L 0.667 28.667 0.667 228.667 L 0.667 428.667 4.230 435.418 C 8.393 443.307,16.683 451.228,24.484 454.770 C 29.710 457.143,34.886 457.276,123.000 457.304 L 216.000 457.333 216.000 424.039 L 216.000 390.744 132.559 390.372 C 38.276 389.952,45.333 390.845,45.333 379.333 C 45.333 367.822,38.276 368.715,132.559 368.295 L 216.000 367.923 216.000 355.333 L 216.000 342.744 132.559 342.372 C 38.276 341.952,45.333 342.845,45.333 331.333 C 45.333 319.822,38.276 320.715,132.559 320.295 L 216.000 319.923 216.000 307.333 L 216.000 294.744 132.559 294.372 C 38.276 293.952,45.333 294.845,45.333 283.333 C 45.333 271.776,37.269 272.713,140.225 272.309 C 231.064 271.952,231.351 271.943,237.333 269.015 C 243.086 266.199,245.186 266.058,288.361 265.585 L 333.389 265.092 333.028 146.879 L 332.667 28.667 329.104 21.915 C 324.940 14.026,316.650 6.106,308.849 2.563 C 300.261 -1.336,33.072 -1.336,24.484 2.563 M279.644 51.023 C 287.488 55.309,288.000 57.820,288.000 92.000 C 288.000 140.596,302.737 135.333,166.667 135.333 C 30.597 135.333,45.333 140.596,45.333 92.000 C 45.333 54.813,45.841 53.176,58.589 49.249 C 66.506 46.810,274.997 48.483,279.644 51.023 M286.108 179.255 C 288.547 182.591,288.546 192.076,286.107 195.412 C 283.137 199.474,50.196 199.474,47.226 195.412 C 43.001 189.634,45.515 178.313,51.333 176.919 C 61.203 174.555,284.294 176.774,286.108 179.255 M231.441 228.588 C 233.880 231.924,233.880 241.410,231.441 244.745 C 228.475 248.801,50.192 248.801,47.226 244.745 C 43.001 238.967,45.514 227.652,51.333 226.249 C 61.037 223.909,229.621 226.099,231.441 228.588 M239.333 277.882 C 234.181 280.172,229.990 284.769,227.397 290.975 C 223.955 299.213,224.375 482.464,227.853 490.000 C 234.414 504.215,233.113 504.000,312.667 504.000 C 392.220 504.000,390.919 504.215,397.480 490.000 C 401.288 481.748,401.288 298.252,397.480 290.000 C 394.632 283.830,390.251 279.444,384.913 277.422 C 378.939 275.158,244.506 275.583,239.333 277.882 M368.298 301.034 C 372.760 305.493,373.777 350.842,369.532 356.087 L 366.905 359.333 314.452 359.679 C 273.717 359.947,261.255 359.640,258.667 358.306 L 255.333 356.588 255.333 328.667 L 255.333 300.745 258.667 299.035 C 261.245 297.711,273.692 297.400,313.631 297.662 L 365.262 298.000 368.298 301.034 M286.378 369.126 C 287.650 369.934,287.992 374.287,287.711 386.106 L 287.333 402.000 271.333 402.000 L 255.333 402.000 254.956 386.106 C 254.505 367.122,253.671 368.041,271.333 368.041 C 278.667 368.041,285.437 368.529,286.378 369.126 M328.458 369.683 C 330.449 371.138,330.709 373.438,330.380 386.683 L 330.000 402.000 313.333 402.000 L 296.667 402.000 296.287 386.683 C 295.817 367.751,295.590 368.000,313.333 368.000 C 321.554 368.000,326.983 368.604,328.458 369.683 M370.378 369.126 C 371.650 369.934,371.992 374.287,371.711 386.106 L 371.333 402.000 355.333 402.000 L 339.333 402.000 338.956 386.106 C 338.505 367.122,337.671 368.041,355.333 368.041 C 362.667 368.041,369.437 368.529,370.378 369.126 M288.000 427.374 L 288.000 444.082 271.667 443.708 L 255.333 443.333 254.952 428.752 C 254.442 409.227,253.088 410.667,271.958 410.667 L 288.000 410.667 288.000 427.374 M330.000 427.333 L 330.000 443.333 313.333 443.333 L 296.667 443.333 296.286 428.752 C 295.772 409.071,294.361 410.517,313.641 410.959 L 330.000 411.333 330.000 427.333 M371.689 447.908 C 372.100 490.310,373.617 486.618,355.776 486.646 C 336.797 486.676,338.667 490.919,338.667 447.816 L 338.667 410.585 355.000 410.959 L 371.333 411.333 371.689 447.908 M287.711 468.561 C 288.161 487.504,288.941 486.619,271.776 486.646 C 253.539 486.675,254.667 487.811,254.667 469.413 C 254.667 450.449,253.263 451.841,271.929 452.293 L 287.333 452.667 287.711 468.561 M330.378 467.809 C 330.860 487.091,331.219 486.667,314.416 486.667 C 295.591 486.667,296.000 487.062,296.000 468.842 C 296.000 450.494,294.536 451.845,313.928 452.294 L 330.000 452.667 330.378 467.809 " />
              </g>
            </svg>
          {/if}
        </AppRailTile>
      {/each}
    </AppRail>
    <nav class="border-l border-r border-surface-500/50 h-full bg-surface-50-900-token w-64 p-4 flex gap-y-6 flex-col">
      {#if $selectedSection}
        {#each Array.from($sidebar.sections.get($selectedSection)?.subsections || []) as [subsectionLabel, links], i}
          <div class="flex flex-col gap-y-1">
            <span class="block text-primary-500 font-bold px-4 pb-2">{subsectionLabel.toUpperCase()}</span>
            {#each links as { label, path }}
              <a href={path} class="!no-underline">
                <span
                  class={`block rounded-full px-4 py-2 ${$sidebar.selectedLink?.inSection === $selectedSection && $sidebar.selectedLink?.inSubsection === subsectionLabel && $sidebar.selectedLink?.label === label ? 'variant-filled-primary' : 'text-white hover:variant-soft-primary'}`}
                >{label}</span>
              </a>
            {/each}
            {#if i !== Array.from($sidebar.sections.get($selectedSection)?.subsections || []).length - 1}
              <div class="border-t border-surface-500/50 mt-4" />
            {/if}
          </div>
        {/each}
      {/if}
    </nav>
  </div>
{/if}